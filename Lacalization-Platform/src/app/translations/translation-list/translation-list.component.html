<!-- Translation list display -->
<table class="table text-white mb-0">
    <thead>
      <tr>
        <th scope="col"><span class="badge badge-light" style="background-color: black; margin-right: 2px;">{{terms.length}}</span>Terms</th>
        <th><div class="dropdown">
          <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            Order by {{ sortOrder }}
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <li><a class="dropdown-item" (click)="updateSortOrder('Date Asc')">Date Asc</a></li>
            <li><a class="dropdown-item" (click)="updateSortOrder('Date Desc')">Date Desc</a></li>
            <li><a class="dropdown-item" (click)="updateSortOrder('Name Asc')">Name Asc</a></li>
            <li><a class="dropdown-item" (click)="updateSortOrder('Name Desc')">Name Desc</a></li>
          </ul>
        </div></th>
        <th style="display: flex; justify-content: end;">
            <button type="button" class="btn btn-primary" data-mdb-ripple-init style="margin-right: 5%;" (click)="openExportModal()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16">
                <path d="M8.5 11.5a.5.5 0 0 1-1 0V7.707L6.354 8.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 7.707z"/>
                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
              </svg>
            </button>

            <button type="button" class="btn btn-primary" data-mdb-ripple-init>
              <i class="fas fa-search"></i>
            </button>
        </th>
      </tr>
    </thead>
    <tbody> 
      <tr class="fw-normal" *ngFor="let term of paginatedTranslation">
        <th>
          <span><input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"></span>
          <span class="ms-2">{{ term.term }}</span>
        </th>
        
        <!-- if that the term, there is no translation saved -->
        <td class="align-middle">
          <ng-container *ngIf="getTranslationForTerm(term.id); else noTranslation">
            <div class="form-control" id="exampleFormControlTextarea1">{{ getTranslationForTerm(term.id)?.translationText }}</div>
          </ng-container>
          <ng-template #noTranslation>
            <textarea 
              class="form-control" 
              [(ngModel)]="draftTranslations[term.id]" 
              (input)="onInput(term.id)"
              [ngClass]="{'active-input': isInputActive(term.id)}"
              rows="2">
            </textarea>
          </ng-template>
        </td>

        <td class="align-middle custom-td">
          <!-- Check if a translation exists for the term -->
          <ng-container *ngIf="getTranslationForTerm(term.id); else noTranslationIcon">
            <!-- If translation exists, show modify and comment buttons -->
            <button class="btn" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Modify">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16" style="color: #0d6efd;">
                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
              </svg>
            </button>
            <button class="btn" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Comment" (click)="openChatModal(term.id)" style="color: #f8994c;">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-wechat" viewBox="0 0 16 16">
                <path d="M11.176 14.429c-2.665 0-4.826-1.8-4.826-4.018 0-2.22 2.159-4.02 4.824-4.02S16 8.191 16 10.411c0 1.21-.65 2.301-1.666 3.036a.32.32 0 0 0-.12.366l.218.81a.6.6 0 0 1 .029.117.166.166 0 0 1-.162.162.2.2 0 0 1-.092-.03l-1.057-.61a.5.5 0 0 0-.256-.074.5.5 0 0 0-.142.021 5.7 5.7 0 0 1-1.576.22M9.064 9.542a.647.647 0 1 0 .557-1 .645.645 0 0 0-.646.647.6.6 0 0 0 .09.353Zm3.232.001a.646.646 0 1 0 .546-1 .645.645 0 0 0-.644.644.63.63 0 0 0 .098.356"/>
                <path d="M0 6.826c0 1.455.781 2.765 2.001 3.656a.385.385 0 0 1 .143.439l-.161.6-.1.373a.5.5 0 0 0-.032.14.19.19 0 0 0 .193.193q.06 0 .111-.029l1.268-.733a.6.6 0 0 1 .308-.088q.088 0 .171.025a6.8 6.8 0 0 0 1.625.26 4.5 4.5 0 0 1-.177-1.251c0-2.936 2.785-5.02 5.824-5.02l.15.002C10.587 3.429 8.392 2 5.796 2 2.596 2 0 4.16 0 6.826m4.632-1.555a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0m3.875 0a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0"/>
              </svg>
            </button>
          </ng-container>
        
          <!-- If no translation exists, show save and comment buttons -->
          <ng-template #noTranslationIcon>
            <button class="btn"
              [disabled]="!isInputActive(term.id)"
              (click)="saveTranslation(term.id)"
              data-bs-toggle="tooltip" 
              data-bs-placement="bottom" 
              title="Save" style="border: 0px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" [ngClass]="{'text-success': isInputActive(term.id), 'text-muted': !isInputActive(term.id)}" class="bi bi-floppy-fill" viewBox="0 0 16 16">
                  <path d="M0 1.5A1.5 0 0 1 1.5 0H3v5.5A1.5 1.5 0 0 0 4.5 7h7A1.5 1.5 0 0 0 13 5.5V0h.086a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5H14v-5.5A1.5 1.5 0 0 0 12.5 9h-9A1.5 1.5 0 0 0 2 10.5V16h-.5A1.5 1.5 0 0 1 0 14.5z"/>
                  <path d="M3 16h10v-5.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5zm9-16H4v5.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5zM9 1h2v4H9z"/>
                </svg>
            </button>
            <button class="btn" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Comment" (click)="openChatModal(term.id)" style="color: #f8994c;">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-wechat" viewBox="0 0 16 16">
                <path d="M11.176 14.429c-2.665 0-4.826-1.8-4.826-4.018 0-2.22 2.159-4.02 4.824-4.02S16 8.191 16 10.411c0 1.21-.65 2.301-1.666 3.036a.32.32 0 0 0-.12.366l.218.81a.6.6 0 0 1 .029.117.166.166 0 0 1-.162.162.2.2 0 0 1-.092-.03l-1.057-.61a.5.5 0 0 0-.256-.074.5.5 0 0 0-.142.021 5.7 5.7 0 0 1-1.576.22M9.064 9.542a.647.647 0 1 0 .557-1 .645.645 0 0 0-.646.647.6.6 0 0 0 .09.353Zm3.232.001a.646.646 0 1 0 .546-1 .645.645 0 0 0-.644.644.63.63 0 0 0 .098.356"/>
                <path d="M0 6.826c0 1.455.781 2.765 2.001 3.656a.385.385 0 0 1 .143.439l-.161.6-.1.373a.5.5 0 0 0-.032.14.19.19 0 0 0 .193.193q.06 0 .111-.029l1.268-.733a.6.6 0 0 1 .308-.088q.088 0 .171.025a6.8 6.8 0 0 0 1.625.26 4.5 4.5 0 0 1-.177-1.251c0-2.936 2.785-5.02 5.824-5.02l.15.002C10.587 3.429 8.392 2 5.796 2 2.596 2 0 4.16 0 6.826m4.632-1.555a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0m3.875 0a.77.77 0 1 1-1.54 0 .77.77 0 0 1 1.54 0"/>
              </svg>
            </button>
          </ng-template>
        </td>        
      </tr>
    </tbody>
  </table>
  <!-- NgbPagination Component -->
  <ngb-pagination 
  *ngIf="shouldShowPagination()"
  [collectionSize]="terms.length"
  [(page)]="currentPage"
  [pageSize]="itemsPerPage"
  (pageChange)="pageChanged($event)"
  [maxSize]="10"
  [rotate]="true"
  [ellipses]="false"
  [boundaryLinks]="true">
  </ngb-pagination>


  <!-- Export Modal -->
<ng-template #modalTemplate let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Select File Format</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <div class="input-group mb-3 position-relative">
      <input 
        type="text" 
        class="form-control" 
        placeholder="Select or type format" 
        [(ngModel)]="selectedFormat" 
        (focus)="showDropdown = true" 
        (input)="filterFormats()"
        (blur)="onBlur()"
        autocomplete="off"
      >
      <ul *ngIf="showDropdown" class="list-group position-absolute w-100 z-index-1">
        <li 
          *ngFor="let format of filteredFormats" 
          class="list-group-item" 
          (click)="selectFormat(format)">
          {{ format }}
        </li>
      </ul>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Close</button>
    <button type="button" class="btn btn-primary" (click)="downloadFile()">Download</button>
  </div>
</ng-template>

  <!-- Chat modal -->
  <ng-template #chatModal let-modal let-term="term">
    <section>
      <div class="row d-flex justify-content-center">
        <div class="col-md-24 col-lg-22 col-xl-20">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center p-3"
              style="border-top: 4px solid #ffa900;">
              <h5 class="mb-0">Chat messages</h5>
              <div class="d-flex flex-row align-items-center">
                <span class="badge bg-warning me-3">{{ comments.length }}</span>
                <i class="fas fa-minus me-3 text-muted fa-xs"></i>
                <i class="fas fa-times text-muted fa-xs" (click)="modal.dismiss()"></i>
              </div>
            </div>
            <div class="card-body" data-mdb-perfect-scrollbar-init style="position: relative; height: 400px; overflow-y: scroll;">

              <div class="d-flex justify-content-between">
                <p class="small mb-1">Timona Siera</p>
                <p class="small mb-1 text-muted">23 Jan 2:00 pm</p>
              </div>
              <div class="d-flex flex-row justify-content-start">
                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava5-bg.webp"
                  alt="avatar 1" style="width: 45px; height: 100%;">
                <div>
                  <p class="small p-2 ms-3 mb-3 rounded-3 bg-body-tertiary">What do you think about this translation?</p>
                </div>
              </div>

              <div *ngFor="let comment of comments" class="mb-3">
                <div class="d-flex justify-content-between">
                  <p class="small mb-1 text-muted">{{ comment.createdAt | date: 'medium' }}</p>
                  <p class="small mb-1">{{ user?.name }}</p>
                </div>
                <div [ngClass]="{'d-flex flex-row justify-content-start': comment.userId !== user?.id, 'd-flex flex-row justify-content-end': comment.userId === user?.id}">
                  <div>
                    <p class="small p-2 ms-3 mb-3 rounded-3" [ngClass]="{'bg-body-tertiary': comment.userId !== user?.id, 'bg-warning text-white': comment.userId === user?.id}">
                      {{ comment.comment }}
                    </p>
                  </div>
                  <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava{{comment.userId !== user?.id ? '5' : '6'}}-bg.webp"
                    alt="avatar 1" style="width: 45px; height: 100%;">
                </div>
              </div>

            </div>
            <div class="card-footer text-muted d-flex justify-content-start align-items-center p-3">
              <div class="input-group mb-0">
                <input type="text" class="form-control" placeholder="Type message"
                  aria-label="Recipient's username" aria-describedby="button-addon2"
                  [(ngModel)]="newComment" />
                <button data-mdb-button-init data-mdb-ripple-init class="btn btn-warning" type="button"
                  id="button-addon2" style="padding-top: .55rem;" (click)="saveComment()">
                  Send
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </ng-template>
  